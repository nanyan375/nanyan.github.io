---
title: 在flask框架内构造一个消息系统
date: 2018-08-06 10:40:17
tags: Python Flask 数据库 消息通知系统
---
在前不久的一段工作历程中，我曾经遇到一个问题。我当时要做一个消息通知系统，但是因为之前没有过类似的经验，而且对编程之道也是一片迷茫，所以完全不知该从何下手，于是在网上找了搜索各种资源，希望能够一劳永逸地能找到一个类似的项目，但是找了很久都没有找到符合自己需要的。倒是在这个过程中看到有网友推荐使用flask-socketio来构造消息系统，也有人推介用socket+redis+gunicorn来构造。尽管当时这些东西对我来说还是很陌生而且高端，但为了解决自己的难题就硬着头皮看了好几天的这些内容。结果却让我很失望，看了这些知识以后，我无法把它们和自己的项目联系起来，还是和之前一样没有头绪。最后只能又厚着脸皮去问技术负责人，结果是我想复杂了，这个消息系统并不是即时通信，没必要用到socket编程，只需要每次请求接口时能够显示消息并统计未读消息就行了。这样一来，顿时觉得心里的压力小了很多，经过过去几天的思考和资料收集，对于这样一个相对简单的消息系统还是有些头绪的，很快我就有了思路，这篇文章即是对这一过程的总结。

#### 1.程序设计思路

这个消息通知系统要求能够实现的功能如下：

* 运营人员发送系统公告；
* 所有用户都能收到系统公告，并列出消息列表；
* 当用户有未读消息时，页面要进行提示(例如标记小红点);
* 当用户读取消息详情时，红点要消失；
* 用户可以删除消息；

程序的设计思路为设计两个数据库表，一个用来表示系统运营消息（OperationMessage），另一个则用来表示用户接收到的消息(Message)，两个数据库表都设置一个`mid`的字段，且`mid`需要打上时间戳。当运营发送消息时，即是将消息存储进OperationMessage类，而当用户接受消息（即请求消息列表这个接口）时，考虑两个情况：

1. 用户在请求接口之前的`Message`库表为空，那么需要将`OperationMessage`库表的所有内容都复制到`Message`；
2. 用户在请求接口之前的`Message`库表不为空，那么需要将`OperationMessage`里比`Message`新的消息复制过来即可；

所有消息都设置一个`is_read`字段，用来表征是否已读,设置默认值为`False`；一个`is_able`字段，用来表征是否可用（不可用即表示已经删除），设置默认值为`True`。从消息列表读取某一条消息的详情时，将该消息的`is_read`字段改为`True`，通过统计`is_read`为`False`字段的数量即可知道未读消息的数目，如果为0，即表示没有未读消息。而如果要删除消息，则只要将消息的`is_able`字段改为`False`即可。

#### 2.数据库设计

#### 3.程序设计

#### 4.心得总结

#### 参考引用
